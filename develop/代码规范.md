## 代码规范记录

好的代码应该:
- 容易理解
- 没有明显的安全问题
- 能够满足最关键的需求
- 有充分的注释
- 使用规范的命名
- 经过充分的测试

坏的代码包括:
- 难以阅读的代码
- 浪费大量计算机资源的代码
- 代码风格混乱的代码
- 复杂的、不直观的代码
- 没有经过适当测试的代码


### 避免错误的几种方法

从别人的失败和自己的失败中学习、积累、提高，是一个程序员成长的必修课

编译器在代码质量方面，作为机器，恪尽职守，它可以帮助我们清除很多错误

软件测试会尽可能地覆盖关键逻辑和负面清单，以确保关键功能能够正确执行，关键错误能够有效处理

代码评审是一个有效的在软件研发过程中抵御人类缺陷的制度。通过更多的眼睛检查软件代码，被忽视的错误更容易被逮住，更好的设计和实现更容易浮现出来

静态代码分析是通过对源代码的检查来发现潜在问题的一种软件质量保障方式。有很多静态代码分析工具可以帮助你检查代码缺陷

-------------------------------------------------

- 解决现实的问题
- 发现关键的问题

-------------------------------------------------

### 代码规范的价值

编码规范指的是针对特定编程语言约定的一系列规则，通常包括文件组织、缩进、注释、声明、语句、空格、命名约定、编程实践、编程原则和最佳实践等

- 规范的代码，可以降低代码出错的几率
- 规范的代码，可以提高编码的效率
- 规范的代码，降低软件维护成本
- 编码规范越使用越高效


-----------------------------------------------------

### 给你的代码起好名字

名字要准确地代表它背后的东西，并且还能让代码干净漂亮

为什么需要命名规范:
- 为标识符提供附加的信息，赋予标识符现实意义。帮助我们理顺编码的逻辑，减少阅读和理解代码的工作量
- 使代码审核变得更有效率，专注于更重要的问题，而不是争论语法和命名规范这类小细节，提高开发效率
- 提高代码的清晰度、可读性以及美观程度
- 避免不同产品之间的命名冲突


常见的命名方法:
- 驼峰命名法指的是使用大小写混合的格式，单词之间不使用空格隔开或者连接字符连接的命名方式。它有两种格式：大驼峰命名法（UpperCamelCase）和小驼峰命名法（lowerCamelCase）
- 在蛇形命名法中，单词之间通过下划线`_`连接，比如`out_of_range`
- 串式命名法, 单词之间通过连字符`-`连接，比如`background-color`


取好名字:
- 要有准确的意义
- 严格遵守命名规范
- 可读性优先


---------------------------------------------------

### 整理代码的关键逻辑

写一篇文章，要层次清楚、段落分明，写代码也是这样。杂志排版，要布局合理，阅读舒适，代码的编排也要这样

很多人不愿意整理代码，觉得这项工作很麻烦。其实代码的整理并不复杂，也不需要什么高深的技巧。有效地使用空行、空格和缩进，简单的分割与对齐，就可以使得代码的视觉效果甚至质量发生巨大的变化，理顺编码的思路，提高编码的效率。这是一个付出少、收获大，值得养成的好习惯


#### 给代码分块

- 保持代码块的单一性，一个代码块只能有一个目标。代码块内所有的内容都是为了一个目标服务的，不能把无关的内容放在同一个代码块里。同一个代码块里语句的相互联系比与相邻代码块里的语句关系更为紧密
- 注意代码块的完整性。代码块是一个完整的信息块。一个代码块要表达一个相对完整的意思，不能一个意思没说完就分块了，就像话说了半句一样
- 代码块数量要适当。代码块过多，会让人觉得路径太长，逻辑复杂，不容易阅读理解。一个基础的代码块最好不要超过 35 行，否则就会有增加阅读理解的困难

#### 使用空白空间

给代码分块的办法之一，就是有效地使用空白空间。空白的空间虽然没有内容，但会给我们重要的信息提示。因此我们写代码的时候，一定要合理地运用空白

代码的分块，通过空格、缩进和空行来整理，或者分割。其中空格可以进行逻辑区隔，用于同一行代码内部的信息分块。缩进用于水平分割，用于表示代码块的级别。空行用于垂直分割，用于分开同级别的不同代码块

- 同级别代码块靠左对齐
- 同行内代码块空格区隔
- 一行一个行为, 每一行代码仅仅表示一个行为。这样每一行的代码才是一个常规大小的、可以识别的基础信息块

#### 基本的换行原则

- 每行代码字符数的限制。一般情况下，每行代码不要超出 80 个字符。由于屏幕尺寸和代码阅读终端的变化，现在的很多规范，开始使用 120 个字符的限制。所以我们编码的时候，需要留意一下
- 如果一行不足以容纳一个表达式，就需要换行

一般换行的原则有以下几点:
- 在逗号后换行
- 在操作符前换行
- 高级别的换行优先
- 新的换行与上一行同级别表达式的开头对齐
- 如果上述规则导致代码混乱或者代码太靠右，使用 8 个空格作为缩进


整理代码有一个基本的思想，那就是把代码分割成大脑能够有效识别并记忆的信息块，通过合理地使用空行、空格和缩进，把这些信息块清晰地呈现出来。清晰的代码结构，可以帮助我们理顺编码的思路，提高编码的效率，减少编码的错误，提高代码的可读性，降低代码的维护成本


----------------------------------------------------

### 写好注释

其实在理想状况下，代码不需要注释。理想的代码，命名恰当，结构清晰，逻辑顺畅，含义显而易见

因为注释不需要运行，所以没有常规的办法来测试它。 注释对不对？有没有随着代码变更？这些问题都是写注释需要注意的地方。注释难以维护，这是使用注释带来的最大的麻烦

注释为我们提供了一个借口。使用注释来解释代码，是注释的本意。但是，我们有时候会过度依赖解释，从而放弃了潜在的替代方案，比如更准确的命名，更清晰的结构，更顺畅的逻辑等等

注释的滥用。 由于注释部分不被执行，那么就可以被用来注释掉一些不需要的东西。比如，在正式的产品代码中，注释掉调试信息、代码块、俏皮话等等

注释是代码的一部分，是需要阅读的内容，目的是让其他人能更好地理解我们的代码，写注释需要我们有用户思维。虽然也有过度依赖注释的情况，但是，对于大部分程序员来说，问题还是注释太少，而不是太多


#### 几种常见的注释类型

- 第一种类型，是记录源代码版权和授权的，一般放在每一个源文件的开头，说明源代码的版权所有者，以及授权使用的许可方式，或者其他的公共信息
- 第二种类型，是用来生成用户文档的，比如 Java Doc。 这部分的作用，是用来生成独立的、不包含源代码的文档。 这些文档帮助使用者了解软件的功能和细节，主要面向的是该软件的使用者，而不是该软件的开发者。 比如 Java 的 API 规范的文档
- 第三种类型，是用来解释源代码的。换句话说，就是帮助代码的阅读者理解代码。这是大家默认的注释类型

**如果一段代码不再需要，我会清理掉代码，而不会保留这个注释掉的代码块**

#### 注释的原则

- 准确，错误的注释比没有注释更糟糕
- 必要，多余的注释浪费阅读者的时间
- 清晰，混乱的注释会把代码搞得更乱


-----------------------------------------------------


### 写好声明

在编程语言里，我们使用标识符来表示不同的逻辑和对象。声明就是用来定义这些标识符的。标识符声明的地方，就是取名字和第一次使用名字的地方

- 取一个好名字
- 一行一个声明
- 局部变量需要时再声明, 标识符的声明应该和它的使用尽可能地靠近，特别是局部变量的标识符声明。这样在视觉上，标识符的定义和使用，可以方便我们阅读和记忆
- 类属性要集中声明, 同样是为了阅读和记忆，类变量的声明则要集中。因为类变量无论是私密变量，还是公开变量，在类的方法实现中，随时都可以调用。我们需要把这些变量放在一起，以便于修改和查找
- 声明时就初始化, 除非变量的初始值依赖于更多的条件，或者涉及到一定的计算，否则，声明时就应该完成初始化。声明时初始化，可以防止初始化的遗漏或者不必要的代码重复
- 尾随的花括号, 左括号不要单独成行，要紧随在语句尾部，以一个空格隔开, 右括号单独一行
- 靠紧的小括号, 小括号一般用来识别一个标识符是不是方法标识符，所以建议小括号要紧靠着标识符，中间不要有空格


------------------------------------------------------------

### 异常处理

处理好异常状况是掌握一门编程语言的基础，也是我们编程离不开的基本功

异常状况的处理会让代码的效率变低。一个流畅的业务，它实现代码的执行路径，理想的状况就是没有任何异常状况发生

很多 API 的设计有检查参数有效性的方法。如果参数通过检验，就没有异常抛出，否则就会抛出异常。在使用这个方法的代码时，我们需要检查有没有抛出异常来确认参数是否有效

#### 分清异常的类别

通常我们说的异常，指的是运行时异常和非运行时异常。对于非正常异常，我们通常使用`错误`这个词


- 不要使用异常机制处理正常业务逻辑
- 异常的使用要符合具体的场景
- 具体的异常要在接口规范中声明和标记清楚


-----------------------------------------------

### 组织好代码块

如果我们看到整齐、清爽的代码，我们就对它有好感，愿意阅读，也愿意改进。 如果代码一团糟，风格混乱，我们就特别想静静地走开，一行都不想看

我们讨论了注释、声明、格式、注解等编码规范。现在，把这些零散的知识放到一块儿了。这些规范组合在一起，就会让代码既有让人喜悦的轮廓，也有让人清爽的细节

代码文件头部结构：
- 版权和许可声明
- 命名空间（package）
- 外部依赖（import）

代码文件对象结构：
- 类的规范
- 类的声明
- 类的属性和方法

类的内部代码结构：
- 类的属性
- 构造方法
- 工厂方法
- 其他方法

方法的代码结构：
- 方法的规范
- 方法的声明
- 方法的实现

一个典型方法的规范，应该包含以下十个部分：
- 方法的简短介绍
- 方法的详细介绍（可选项）
- 规范的注意事项
- 实现方法的要求
- 实现的注意事项
- 方法参数的描述
- 返回值的描述
- 抛出异常的描述：需要注意的是，抛出异常的描述部分，不仅要描述检查型异常，还要描述运行时异常


**使用空行分割代码块**

-----------------------------------------------------

### 组织好代码文件---用户思维

最开始接触一个项目代码时，我们最渴望的，就是快速揭开项目的面纱。这个项目是干什么的？是怎么做的？该怎么使用？

刚拿到一个项目的代码时，你最想找哪一个文件？面对大量的文件，该从哪里入手？创建一个项目时，各式各样的文件该怎么规整？

#### 软件是干什么的？

无论我们开始一个软件项目，还是阅读一个软件的代码，第一个遇到的问题就是，这个软件是干什么的？

可以回答这个问题的文件叫做 `README`，它的命名全部使用大写字母。需要被放在一个软件工程的根目录里，方便人或者机器第一时间找到，从而轻而易举地找到并进行阅读。

这个问题的描述，要记录在代码的工程里。可以让代码的阅读者轻而易举地找到并阅读。

由于机器的参与，尤其是在线代码管理服务（比如 GitHub、Maven）的广泛使用，`README` 的名字和位置也就慢慢地形成了共识。

#### 软件可以拿来用吗？

所有的软件，都有归属，都受版权的保护。谁拥有这个软件的版权？这是我们需要关注的一个问题。

有时候，一个软件包含很多贡献者，不同的贡献者有不同的版权诉求。软件的不同部分，就有不同的版权。

这种情况下，版权描述一般放在每一个源文件的头部。不同的源文件可以有不同的版权，同一个源文件也可以有一个以上的版权所有者。

如果版权来源只有一个，而且源文件头部没有版权描述，我们就需要把版权描述放到最显眼的地方。这个地方就是软件工程的根目录，命名为 `COPYRIGHT`，全部使用大写字母

没有版权描述的软件，并不是没有版权保护。如果一个软件没有版权描述或者版权描述不清晰，使用起来有很多法律风险。如果这个软件依赖外部的版权，那么问题就会变得更为复杂。

有了版权保护，不代表我们就不能使用这个软件了。我们能不能使用、怎么使用，是由软件的许可证确定的

许可证文件是 `LICENSE`，全部使用大写字母，放在软件工程项目的根目录下。当使用软件的时候，不能超越许可证约定的范围。 一个没有许可证的软件，我们是不能使用的，因为不知道许可的范围，也不知道应承担的义务。同样，如果一个软件的许可证不清晰，或者我们不了解，那么使用起来也会有很多法律问题

#### 软件是怎么实现的？

代码的位置在现在的软件工程里有了一定的共识。通常来说，源代码存放在根目录下的 src 目录下

但源代码并不能一股脑地堆在 src 这一个目录里。src 目录下面可以有很多子目录。一般来说，稍具规模、相对正规的软件，都需要有命名空间的区隔。使用命名空间的区隔至少有三个好处:
- 可以把一个组织的代码和另外一个组织的代码区隔开
- 可以把一个项目的代码和另外一个项目的代码区隔开
- 可以把一个模块的代码和另外一个模块的代码区隔开

如果软件项目把所有的源代码文件不加分别地放在同一个目录下，说明软件的开发人员并没有厘清代码之间的逻辑关系。纠缠在一起的代码越多，代码越难以维护，代码的安全越难以保证

#### 软件该怎么测试？

有很多传统的软件项目，测试代码和功能代码是放在同一个目录下的。如果一个项目比较小，那么这样做也许没什么大问题。一旦软件工程变得复杂，这样做就会让项目变得难以管理，尤其是在测试人员和开发人员分离的情况下。

现在的很多软件项目，大都采用了分离的组织方式。通常来说，源代码要存放在根目录下的 test 目录下

仅仅放置在对应的目录下还不够，测试文件本身还有一个需要注意的地方，一个测试文件，最好执行一个独立的任务。如果测试出错误，我们就能够快速定位错误。这也要求测试的目标要小，测试的结果要清晰，测试的组织要照应功能代码的组织

#### 软件该怎么使用？

使用软件工程项目文件的，不仅仅只有程序员，还有软件的用户。

一个好的软件，要尽可能降低使用门槛。编写使用指南和代码示例是两个常用的办法。一份好的用户文档，应该让软件的用户快速入门，然后再逐步深入地了解整个软件的使用细节，以及潜在的问题

软件的文档，需要随着软件的变更不断升级维护。有很多项目会把文档和代码分开管理

如果你留意，就会注意到现在的很多项目，在根目录下，有一个名字为 `docs` 或者 `doc` 的目录。 这个目录就是存放软件文档的

作为程序员，我们不仅要熟悉源代码，还要熟悉文档。当需要更直观的用户指南或者代码示例时，就要写作这样的软件文档。对于每一行的代码变更，我们都要问，需不需要文档变更？如果代码和文档一致的话，就会节省我们大量的维护时间和维护成本。

------------------------------------------------

### 接口规范，是协作的合约

一个软件项目，一般需要交付两类文档。一类文档是面向开发者的，另一类文档是面向最终用户的。这两类文档，由于面向用户的不同，无论是内容还是形式，都有巨大的差异

#### 区分外部接口和内部实现

一个好的软件设计，要区分外部接口和内部实现。外部接口，就是协作的界面，要简单规矩；内部实现，可以是千变万化的复杂小世界

我们区分了接口和实现，调用者就不用去关心这些复杂的实现了，只需要理解接口规范就好

外部接口，要少、要小、要描述清楚


#### 接口规范是协作合约

无论对于调用者，还是实现者来说，外部接口的使用都要有章可循，有规可依。如果调用者需要去看实现代码来理解外部接口，那么外部接口和内部实现的分离还有什么用呢？

接口规范主要用来描述接口的设计和功能，包括确认边界条件、指定参数范围以及描述极端状况。比如，参数错了会出什么错误？

接口的设计和规范的制定，一定要谨慎再谨慎，小心再小心，反复推敲，反复精简。一旦接口合约制定，公布，然后投入使用，就尽最大努力保持它的稳定，即使这个接口或者合约存在很多不足

接口合约毕竟不是租房合约，可以一年一续，每年变更一次。租房合约的变更成本很小，但软件的接口合约变更的影响要严重得多。特别是兼容性问题，稍微一丁点儿的接口规范变化，都可能导致大面积的应用崩溃。越成功的接口，使用者越多，变更的影响也就越大，变更的成本也就变高，变更也就越困难

--------------------------------------------

### 怎么写好用户指南

最好的用户指南，是产品本身。我们随手拿一只圆珠笔，就知道怎么用。然而，不是所有的产品都能够简单到拿来就用。一份合格的用户指南，要帮助用户减少产品使用的障碍，快速地使用产品

一般来说，我们把用户的门槛降得越低，潜在用户的群体就越大，软件就越容易推广

#### 保持指南和代码的一致

和接口规范一样，用户指南一般也是由程序员和其他的作者一同完成的。和接口规范不一样的是，接口规范可以在源代码文件中定义、描述，而用户指南通常是独立于源代码的文档。这种分离的组织形式，经常会让用户指南和源代码脱节。如果维护指南的作者和维护源代码的作者不是同一个人，脱节就会更加严重，导致维护和服务都很困难

#### 开发指南的实践

开发指南是一类我们经常接触的用户指南，它的典型用户是使用该软件 API 的软件工程师

接口规范描述的是每一个部件的规格，是一个细节、局部的范围。开发指南说的就是怎么理解这些部件之间的关系，怎么把这些部件组合起来，形成更大的部件或者产品

------------------------------------------------

### 编写规范代码的检查清单

- 代码是按照编码指南编写的吗？
- 代码能够按照预期工作吗？
- 文件是不是在合适的位置？
- 支撑文档是不是充分？
- 代码是不是易于阅读、易于理解？
- 代码是不是易于测试和调试？
- 有没有充分的测试，覆盖关键的逻辑和负面清单？
- 名字是否遵守命名规范？
- 名字是不是拼写正确、简单易懂？
- 名字是不是有准确的意义？
- 代码的分块是否恰当？
- 代码的缩进是否清晰、整洁？
- 有没有代码超出了每行字数的限制？
- 代码的换行有没有引起混淆？
- 每一行代码是不是只有一个行为？
- 变量的声明是不是容易检索和识别？
- 变量的初始化有没有遗漏？
- 括号的使用是不是一致、清晰？
- 源代码的组织结构是不是一致？
- 版权信息的日期有没有变更成最近修改日期？
- 限定词的使用是不是遵循既定的顺序？
- 有没有注释掉的代码？
- 有没有执行不到的代码？
- 有没有可以复用的冗余代码？
- 复杂的表达式能不能拆解成简单的代码块？
- 代码有没有充分的注释？
- 注释是不是准确、必要、清晰？
- 不同类型的注释内容，注释的风格是不是统一？
- 有没有使用废弃的接口？
- 有没有使用异常机制处理正常的业务逻辑？
- 异常类的使用是不是准确？
- 异常的描述是不是清晰？
- 外部接口和内部实现有没有区分隔离？
- 接口规范描述是不是准确、清晰？
- 接口规范有没有描述返回值？
- 接口规范有没有描述运行时异常？
- 接口规范有没有描述检查型异常？
- 接口规范有没有描述指定参数范围？
- 接口规范有没有描述边界条件？
- 接口规范有没有描述极端状况？


-------------------------------------------

### 经济的代码

代码的性能并不是可以多块地进行加减乘除，而是如何管理内存、磁盘、网络、内核等计算机资源。代码的性能与编码语言关系不大，就算是 JavaScript 编写的应用程序，也可以很快，C 语言编写的程序也可能很慢

事实上，代码的性能和算法密切相关，但是更重要的是，我们必须从架构层面来考虑性能，选择适当的技术架构和合适的算法。很多纸面上看起来优美的算法，实际上很糟糕。也有很多算法看起来不咋样，但实际上很高效。为了管理代码的性能，在一定程度上，我们需要很好地了解计算机的硬件、操作系统以及依赖库的基本运行原理和工作方式。一个好的架构师，一定会认真考虑、反复权衡性能要求

**代码的质量才是网络安全防护的根本**

扩展硬件并不是总能够线性地提高系统的性能。出现性能问题，投入更多的设备，只是提高软件性能的一个特殊方法。而且，这不是一个廉价的方法

性能问题，有很多是架构性问题。一旦架构性问题出现，往往意味着代码要推倒重来


------------------------------------------------------

