## 操作系统

### 操作系统的演进

1. 无操作系统
   - 人工操作
   - 用户独占
   - CPU 等待人工操作
   - 资源利用率很低

2. 批处理系统
   - 无需等待人工操作
   - 批量输入任务
   - 资源利用率提升
   - 多道程序设计

3. 分时系统
   - 人机交互
   - 多用户共享
   - 及时调试程序

多道程序设计

- 早期的批处理系统只能一次处理一个任务
- 多道程序设计使得批处理系统可以一次处理多个任务
- 多道程序设计是指在计算机内存中同时存放多个程序
- 多道程序在计算机的管理程序之下相互穿插运行
- 多道程序的管理是操作系统的重要功能

### 操作系统涉及的五大功能

1. 进程管理
   - 进程实体
   - 五种状态模型
   - 进程同步
   - Linux的进程管理
2. 存储管理
   - 内存分配与回收
   - 段页式存储管理
   - 虚拟内存
   - Linux的存储管理
3. 作业管理
   - 进程调度
   - 死锁
4. 文件管理
   - Linux 的文件系统
   - Linux文件的基本操作
5. 设备管理


### 操作系统概述
操作系统是管理硬件，提供用户交互的软件系统

操作系统可以看作是计算机硬件的一种抽象

#### 什么是操作系统

1. 操作系统是管理计算机硬件和软件资源的计算机程序
2. 管理配置内存，决定资源供需顺序，控制输入输出设备等
3. 操作系统提供让用户和系统交互的操作界面

#### 常见的操作系统
- Android
- IOS
- Windows
- Linux
- MacOS

#### 操作系统的基本功能

计算机的资源包括如下:
- 处理器资源
- 存储器资源
- IO 设备资源
- 文件资源

而操作系统统一管理着上述计算机资源

例如我们操作一个文件并不是直接去在磁盘上操作该文件，而是通过操作系统来进行操作的

有了操作系统之后，用户无需面向硬件接口编程，在操作系统中有 IO设备管理软件，由这些软件提供读写接口，供用户使用，而无需直接操作硬件

操作系统实现了对计算机资源的抽象

操作系统提供了用户与计算机之间的接口

- 图形窗口形式，windows常用
- 命令形式，Linux常用
- 系统调用形式，编程时常用


层次结构：用户--> 系统调用/命令/图形窗口--> 操作系统--> 计算机硬件

#### 操作系统相关概念

- 并发性
- 共享性
- 虚拟性
- 异步性

##### 并发性
并行 VS 并发

- 并行是指两个或多个时间可以在**同一时刻**发生
- 并发是指两个或者多个时间可以在**同一个时间间隔**发生


在单处理器上多道程序交替运行，程序并发执行

在多处理器上不同程序可以分别在不同的处理器上并行执行，在某一个处理器上也并发执行

##### 共享性

共享性表现为操作系统中的资源可供多个并发的程序共同使用，这种共同使用的形式称之为资源共享

互斥共享资源：
当共享资源被进程A占用时，其他想使用该资源的只能等待，只有进程A使用完以后，其他进程才可以使用该资源


同时共享资源：
某种资源在一段时间内并发的被多个进程访问，这种同时是宏观的，从宏观上看该资源可以被同时访问

##### 虚拟性

虚拟性表现为把一个物理实体转变位若干个逻辑实体，物理实体是真实存在的，逻辑实体是虚拟的

虚拟的技术主要有**时分复用技术**和**空分复用技术**

时分复用技术：
资源在时间上进行复用，不同程序并发使用，多道程序分时使用计算机的硬件资源，提高资源利用率

- 虚拟处理器技术：借助多道程序设计技术，为每个程序建立进程，多个进程分时复用处理器

- 虚拟设备技术：物理设备虚拟为多个逻辑设备，每个程序占用一个逻辑设备，多个程序通过逻辑设备并发访问

空分复用技术：空分复用技术用来实现虚拟磁盘，虚拟内存的

- 虚拟磁盘技术：物理磁盘虚拟为逻辑磁盘，比如一个物理磁盘被划分为 C，D，D 等逻辑盘，使用起来更加安全，方便
- 虚拟内存技术：在逻辑上扩大程序的存储容量，使用比实际内存更大的容量，大大提升编程效率


##### 异步性

在多道程序环境下，允许多个进程并发执行，进程在使用资源时可能需要等待或放弃，进程的执行并不是一气呵成的，而是以走走停停的形式推进


-----------------------------------------


### 进程管理

#### 进程实体

操作系统的主要功能就是管理计算机的硬件资源，比如处理器资源，存储器资源，IO设备资源，文件资源等，没有配置OS之前，资源属于当前运行的程序，当程序在使用处理器资源的时候，其他资源是空闲的，为了提供资源利用率，就引入了多道程序涉及的概念，OS出现之后，进程就出现了，进程的主要功能是合理的隔离资源，运行环境，提升资源利用率

- 进程是系统进行资源分配和调度的基本单位，引入多道程序涉及之后，操作系统就可以为每个进程进行资源分配了

- 进程作为程序独立运行的载体保障程序正常执行

- 进程的存在使得操作系统资源的利用率大幅提升


##### 主存中的进程形态

在主存中进程是一段连续的存储空间，这个空间称之为**进程控制块**

进程控制块中的信息:

- 标识符，标识符唯一标记一个进程，用于区别其他进程
- 状态，标记进程的进程状态，如 运行态
- 优先级，
- 程序计数器，指向进程即将被执行的下一条指令的地址
- 内存指针，程序代码，进程数据相关指针
- 上下文数据，进程执行时处理器存储的数据
- IO状态信息，被进行IO操作所占用的文件列表
- 记账信息，使用处理器时间，时钟数总和等

以上进程控制块可以分为4类:
1. 进程标识符
2. 处理机状态
3. 进程调度信息
4. 进程控制信息

#### 进程控制块(PCB)

用于描述和控制进程运行的通用数据结构，记录进程当前状态和控制进程运行的全部信息，PCB 使得进程是能够独立运行的基本单位

PCB 是操作系统进行调度经常会被读取的信息，他是常驻内存的，存放在系统专门开辟的PCB区域内

#### 进程与线程

- 进程，Process
- 线程，Thread

一个进程可以有一个或多个线程


线程是操作系统进行运行调度的最小单位，进程是系统进行资源分配和调度的基本单位

操作系统对进程的调度实际上是对进程内线程的调度，线程包含在进程之中，是进程中实际运行工作的单位

一个进程可以并发多个线程，每个线程执行不同的任务

进程中的线程共享进程资源

类别|进行|线程
:--:|:--:|:--:
资源|资源分配的基本单位|不拥有资源
调度|独立调度的基本单位|独立调度的最小单位
系统开销|进程开销大|线程开销小
通信|进程IPC|读写同一进程数据通信


-------------------------

### 进程的五种状态模型

- 创建，创建进程时拥有PCB但其他资源尚未就绪的状态称为 创建状态，操作系统提供了 fork 函数创建进程
- 就绪，其他资源都准备好了，只差CPU资源的状态称为 就绪状态，在一个系统中多个处于就绪状态的进程通常排除一个队列，称为就绪队列
- 阻塞，进程因为某种原因，如其他设备未就绪而无法继续执行，从而放弃CPU的状态称为 阻塞状态，多个阻塞进程会形成一个阻塞队列
- 执行，进程获得CPU，其程序正在执行称为 执行状态，在单处理机中，在某个时刻只能有一个进程是处于执行状态
- 终止，进程结束由系统清理或归还 PCB 的状态称为 终止状态

状态之间的切换:

- 就绪--> 执行
- 执行--> 就绪
- 执行--> 阻塞
- 阻塞--> 就绪


